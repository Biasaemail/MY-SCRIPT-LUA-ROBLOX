--[[
    Ultimate Draggable Teleport Tool
    Lokasi: StarterPlayer > StarterPlayerScripts (dalam sebuah LocalScript)
    Fitur:
    - Frame GUI yang bisa digeser.
    - Tombol Teleport (TP) utama.
    - Tombol On/Off untuk mengaktifkan/menonaktifkan fungsi TP.
    - Tombol 'X' untuk menghapus GUI dan menonaktifkan skrip sepenuhnya.
--]]

--// Layanan (Services)
local UserInputService = game:GetService("UserInputService")
local TeleportService = game:GetService("TeleportService")
local Players = game:GetService("Players")

--// Konfigurasi
local PRE_SUMMIT_POS = CFrame.new(625.52, 1799.24, 3432.26)
local SUMMIT_POS = CFrame.new(807.26, 2161.11, 3921.25)

--// Variabel Status
local localPlayer = Players:GetPlayerFromCharacter(script.Parent) or Players.LocalPlayer
local playerGui = localPlayer:WaitForChild("PlayerGui")

local isScriptActive = true -- Status On/Off untuk fungsi teleport
local isTeleporting = false -- Mencegah spam klik TP
local isDragging = false    -- Menandakan apakah frame sedang digeser
local dragStartPos, guiStartPos

-- Tabel untuk menyimpan semua koneksi event agar bisa diputus saat 'X' ditekan
local connections = {}

--// Komponen GUI (dideklarasikan di sini agar bisa diakses oleh semua fungsi)
local screenGui, mainFrame, tpButton, onOffButton, closeButton

--// Fungsi untuk Membersihkan Semuanya (Self-Destruct)
local function cleanup()
    -- Putuskan semua koneksi event untuk mencegah memory leak
    for _, connection in ipairs(connections) do
        if connection then
            connection:Disconnect()
        end
    end
    table.clear(connections) -- Kosongkan tabel
    
    -- Hapus GUI dari layar
    if screenGui then
        screenGui:Destroy()
    end
    
    -- Opsional: Hentikan skrip ini agar tidak berjalan lagi
    script.Disabled = true
end

--// Fungsi untuk Membuat GUI
local function createGUI()
    screenGui = Instance.new("ScreenGui")
    screenGui.Name = "TeleportToolGui"
    screenGui.ResetOnSpawn = false
    
    -- Frame utama yang akan menjadi wadah dan bisa digeser
    mainFrame = Instance.new("Frame")
    mainFrame.Name = "MainFrame"
    mainFrame.Size = UDim2.new(0, 130, 0, 40)
    mainFrame.Position = UDim2.new(0.5, -65, 0.1, 0)
    mainFrame.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
    mainFrame.BackgroundTransparency = 0.2
    mainFrame.BorderSizePixel = 0
    mainFrame.Active = true -- Penting untuk menangkap input drag
    mainFrame.Draggable = true -- Memungkinkan drag bawaan (lebih simpel)
    mainFrame.Parent = screenGui
    
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 8)
    corner.Parent = mainFrame
    
    -- Tombol Teleport (TP)
    tpButton = Instance.new("TextButton")
    tpButton.Name = "TeleportButton"
    tpButton.Size = UDim2.new(0, 50, 0, 30)
    tpButton.Position = UDim2.new(0, 5, 0.5, -15)
    tpButton.BackgroundColor3 = Color3.fromRGB(0, 122, 255)
    tpButton.Text = "TP"
    tpButton.Font = Enum.Font.SourceSansBold
    tpButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    tpButton.TextSize = 16
    tpButton.Parent = mainFrame
    local tpCorner = Instance.new("UICorner"); tpCorner.CornerRadius = UDim.new(0, 6); tpCorner.Parent = tpButton
    
    -- Tombol On/Off
    onOffButton = Instance.new("TextButton")
    onOffButton.Name = "OnOffButton"
    onOffButton.Size = UDim2.new(0, 50, 0, 30)
    onOffButton.Position = UDim2.new(0, 60, 0.5, -15)
    onOffButton.BackgroundColor3 = Color3.fromRGB(10, 200, 100) -- Hijau untuk 'ON'
    onOffButton.Text = "ON"
    onOffButton.Font = Enum.Font.SourceSansBold
    onOffButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    onOffButton.TextSize = 16
    onOffButton.Parent = mainFrame
    local onOffCorner = Instance.new("UICorner"); onOffCorner.CornerRadius = UDim.new(0, 6); onOffCorner.Parent = onOffButton
    
    -- Tombol Tutup (X)
    closeButton = Instance.new("TextButton")
    closeButton.Name = "CloseButton"
    closeButton.Size = UDim2.new(0, 20, 0, 20)
    closeButton.Position = UDim2.new(1, -22, 0, 2) -- Pojok kanan atas frame
    closeButton.BackgroundColor3 = Color3.fromRGB(255, 50, 50)
    closeButton.Text = "X"
    closeButton.Font = Enum.Font.SourceSansBold
    closeButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    closeButton.TextSize = 14
    closeButton.BackgroundTransparency = 0.5
    closeButton.Parent = mainFrame
    local closeCorner = Instance.new("UICorner"); closeCorner.CornerRadius = UDim.new(0.5, 0); closeCorner.Parent = closeButton

    screenGui.Parent = playerGui
end

--// Fungsi Logika
function startTeleportSequence()
    if not isScriptActive or isTeleporting then return end
    isTeleporting = true
    tpButton.Enabled = false
    tpButton.Text = "..."
    
    local character = localPlayer.Character or localPlayer.CharacterAdded:Wait()
    
    local success, message = pcall(function()
        character:PivotTo(PRE_SUMMIT_POS)
        task.wait(1)
        character:PivotTo(SUMMIT_POS)
        task.wait(1)
        TeleportService:TeleportToPlaceInstance(game.PlaceId, game.JobId, localPlayer)
    end)
    
    if not success then
        warn("Teleportasi GAGAL: " .. tostring(message))
        isTeleporting = false
        tpButton.Enabled = true
        tpButton.Text = "TP"
    end
end

function toggleScriptActive()
    isScriptActive = not isScriptActive
    
    if isScriptActive then
        onOffButton.Text = "ON"
        onOffButton.BackgroundColor3 = Color3.fromRGB(10, 200, 100) -- Hijau
        tpButton.BackgroundColor3 = Color3.fromRGB(0, 122, 255) -- Warna normal
    else
        onOffButton.Text = "OFF"
        onOffButton.BackgroundColor3 = Color3.fromRGB(200, 40, 40) -- Merah
        tpButton.BackgroundColor3 = Color3.fromRGB(100, 100, 100) -- Abu-abu (nonaktif)
    end
end

--// Inisialisasi dan Koneksi Event
createGUI()

-- Simpan setiap koneksi ke dalam tabel agar bisa diputus nanti
table.insert(connections, tpButton.MouseButton1Click:Connect(startTeleportSequence))
table.insert(connections, onOffButton.MouseButton1Click:Connect(toggleScriptActive))
table.insert(connections, closeButton.MouseButton1Click:Connect(cleanup))